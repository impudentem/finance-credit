var threeStepController;threeStepController=function(){function t(t,e,n,i,o,s,r,a,c){this.$http=t,this.$scope=e,this.$rootScope=n,this.$sce=i,this.$location=o,this.$element=s,this.$sceDelegate=r,this.$filter=a,this.$timeout=c,this.data={cities:{},employments:{}},this.$scope.$watch(function(t){return function(e,n,i){return t.$scope.main.currentStep}}(this),function(t){return function(e,n,i){if(t.$iElement=$(t.$element),3===(e=parseInt(e)))return t.data.employments={},t.data.cities={},t.init("cities",function(t){return t&&"success"===t.result&&(this.data.cities=t.data),this.init("employments",function(t){if(t&&"success"===t.result)return this.data.employments=t.data})})}}(this)),this.$scope.$watch(function(t){return function(e,n,i){return t.data}}(this),function(t){return function(e,n,i){if(Object.size(t.data.cities)&&Object.size(t.data.employments))return t.update()}}(this),!0)}return t.prototype.card_hover=function(t,e){return this.$scope.cards_three.card_hover="mouseover"===t.type?e:""},t.prototype.prevStep=function(){return this.$scope.main.loading=!0,this.data.employments={},this.data.cities={},this.$scope.main.$location.path("/s2")},t.prototype.nextStep=function(){var t,e;return e=$(this.$element).find(".ui.form"),(e=e.data("module-form"))&&e.is.valid()?(this.$scope.main.loading=!0,t={aims:this.$scope.$storage.strgData.aims,amount:this.$scope.$storage.strgData.amount,name:this.$scope.$storage.strgData.name,phone:this.$scope.$storage.strgData.phone,bday:this.$scope.$storage.strgData.bday,employment:this.$scope.$storage.strgData.employment,city:this.$scope.$storage.strgData.city,utime:(new Date).getTime()},this.$scope.$storage.strgData.noinn||(t.inn=this.$scope.$storage.strgData.inn),!0===this.$rootScope.settings.api.debug&&(t.result=""+!1),this.data.employments={},this.data.cities={},this.post(t,function(t){return function(e){if(t.$location.path("/request"),t.$scope.main.statusReq="success"===(null!=e?e.result:void 0),t.$scope.$storage.$reset(),!t.$scope.$$phase)return t.$scope.$apply()}}(this))):e?e.validate.form():void 0},t.prototype.update=function(){var t,e,n;return t=this.$iElement.find(".ui.dropdown.city").dropdown({selectOnKeydown:!1,allowReselection:!0,forceSelection:!1,hideAdditions:!1,allowAdditions:!0,message:{addResult:"<b>{term}</b>",noResults:"Ничего не найдено."},onChange:function(t){return function(e,n,i){return t.$scope.$storage.strgData.city=n,t.$scope.$storage.strgData.city_val=e}}(this)}),e=this.$iElement.find(".ui.dropdown.employment").dropdown({onChange:function(t){return function(e,n,i){return t.$scope.$storage.strgData.employment=e}}(this)}),this.$iElement.find(".ui.checkbox.noinn").checkbox().first().checkbox({fireOnInit:!0,onChecked:function(t){return function(){return t.$scope.$storage.strgData.noinn=!0,t.chngMsg("remove")}}(this),onUnchecked:function(t){return function(){return t.$scope.$storage.strgData.noinn=!1,t.chngMsg("add")}}(this)}),this.$scope.$storage.strgData.city_val&&this.$timeout(function(e){return function(){return t.data("module-dropdown").set.selected(e.$scope.$storage.strgData.city)}}(this)),this.$scope.$storage.strgData.employment&&this.$timeout(function(t){return function(){return e.data("module-dropdown").set.selected(t.$scope.$storage.strgData.employment)}}(this)),n={mask:"U{1,128}",greedy:!1,showMaskOnHover:!1,oncomplete:function(t){return function(e){return t.$scope.$storage.strgData.city=e.target.value}}(this)},$('input[name="city"], .ui.dropdown input.search').inputmask(n),n={mask:"9999999999",greedy:!1,showMaskOnHover:!1,oncomplete:function(t){return function(e){return t.$scope.$storage.strgData.inn=e.target.value}}(this),onKeyDown:function(t){return function(e){return t.$scope.$storage.strgData.inn=e.target.value}}(this)},$('input[name="inn"]').inputmask(n),$(this.$element).find(".ui.form").form({inline:!0,on:"blur",fields:{employment:{identifier:"employment",rules:[{type:"empty",prompt:"Выберите трудоустройство"}]},city:{identifier:"city",rules:[{type:"empty",prompt:"Введите ваш город"}]}}}),this.chngMsg("add"),this.$scope.main.loading=!1},t.prototype.chngMsg=function(t){var e,n;return n=$(this.$element).find(".ui.form"),e=this.$iElement.find(".ui.button.submit"),"add"===t?(n.form("add rule","inn",{rules:[{type:"integer[10...10]",prompt:"Неправильный ИНН"}]}),e.popup({transition:"horizontal flip",position:"right center",target:"#inn",content:"Без ИНН шансы на получение кредита значительно уменьшаются. Часть банков не будет рассматривать заявку, если отправить её без ИНН."})):(n.form("remove fields",["inn"]),n.form("validate field","inn"),e.popup("destroy"))},t.prototype.init=function(t,e){var n,i,o;if(this.fn=e,t)return i={data:t},o=this.$sceDelegate.trustAs(this.$sce.RESOURCE_URL,""+this.$rootScope.settings.api.url+this.$rootScope.settings.api.command.list),n=function(t){return function(e){return"function"==typeof t.fn?t.fn(e.data):void 0}}(this),this.$http.jsonp(o,{params:i}).then(n,n)},t.prototype.post=function(t,e){var n,i,o;if(this.fn=e,t)return i={data:t},o=this.$sceDelegate.trustAs(this.$sce.RESOURCE_URL,""+this.$rootScope.settings.api.url+this.$rootScope.settings.api.command.put),n=function(t){return function(e){return"function"==typeof t.fn?t.fn(e.data):void 0}}(this),this.$http.jsonp(o,{params:i}).then(n,n)},t}();